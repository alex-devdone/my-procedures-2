# Ralphy Progress Log

- [✓] 2026-01-19 20:55 - Update todo schema to add userId foreign key
- [✓] 2026-01-19 20:56 - Run database migration
- [✓] 2026-01-19 20:59 - Update todo router to use protectedProcedure
- [✓] 2026-01-19 21:01 - Create auth client for frontend
- [✓] 2026-01-19 21:05 - Create login page
- [✓] 2026-01-19 21:05 - Create signup page
- [✓] 2026-01-19 21:06 - Create auth layout with protected routes
- [✓] 2026-01-19 21:07 - Create local storage service for todos
- [✓] 2026-01-19 21:11 - Create todo storage abstraction hook
- [✓] 2026-01-19 21:12 - Create header with auth state
- [✓] 2026-01-19 21:15 - Update todo components to use storage abstraction
- [✓] 2026-01-19 21:18 - Add sync local todos to database on login
- [✓] 2026-01-19 21:22 - Refactor to entity-based API structure
- [✓] 2026-01-19 21:24 - Update CLAUDE.md with entity-based API structure
- [✓] 2026-01-19 21:24 - Fix useSyncExternalStore infinite loop in todo.hooks.ts
- [✓] 2026-01-19 21:26 - Change default dev port to 4757
- [✓] 2026-01-19 21:39 - Redesign app UI/UX using frontend-design skill
- [✓] 2026-01-19 21:43 - Set up unit testing infrastructure
- [✓] 2026-01-19 21:50 - Extract business logic into testable hooks/utilities
- [✓] 2026-01-19 21:58 - Write unit tests for business logic
- [✓] 2026-01-19 21:58 - Fix 403 INVALID_ORIGIN error in Better-Auth

- [✓] 2026-01-19 22:15 - Set up Playwright for E2E testing
- [✓] 2026-01-19 23:19 - Write E2E tests for todo CRUD operations
- [✓] 2026-01-19 23:35 - Fix todo toggle causing full list reload

- [✓] 2026-01-20 22:54 - Create folder schema (packages/db/src/schema/folder.ts) with id, name, color, userId, createdAt, order
- [✓] 2026-01-20 22:54 - Add unit tests for folder schema validation (packages/db/src/schema/folder.test.ts)
- [✓] 2026-01-20 22:57 - Update todo schema with scheduling fields (dueDate, reminderAt, recurringPattern, folderId) and indexes
- [✓] 2026-01-20 22:57 - Add unit tests for updated todo schema (packages/db/src/schema/todo.test.ts)
- [✓] 2026-01-20 23:01 - Create subtask schema (packages/db/src/schema/subtask.ts) with id, text, completed, todoId, order
- [✓] 2026-01-20 23:01 - Add unit tests for subtask schema (packages/db/src/schema/subtask.test.ts)
- [✓] 2026-01-20 23:03 - Update schema index to export folder and subtask schemas, add subtasks relation to todoRelations
- [✓] 2026-01-20 23:13 - Generate Drizzle migrations (0001_easy_sally_floyd.sql) for folder, subtask tables and todo scheduling fields
- [✓] 2026-01-20 23:25 - Apply database schema changes using db:push (folder, subtask tables and todo scheduling fields)

- [✓] 2026-01-20 23:21 - Create folder router (packages/api/src/routers/folder.ts) with CRUD procedures: list, create, update, delete, reorder
- [✓] 2026-01-20 23:21 - Add unit tests for folder router (packages/api/src/routers/folder.test.ts) with 58 tests
- [✓] 2026-01-20 23:21 - Add folder router to main tRPC router (packages/api/src/routers/index.ts)
- [✓] 2026-01-20 23:21 - Add Zod validation schemas for folder inputs (folderColorSchema, createFolderInputSchema, updateFolderInputSchema, deleteFolderInputSchema, reorderFolderInputSchema)
- [✓] 2026-01-20 23:21 - Add missing drizzle-orm exports (gt, gte, lt, lte) to packages/db/src/index.ts

- [✓] 2026-01-20 23:25 - Create folder.types.ts with TypeScript types (Folder, RemoteFolder, LocalFolder, FolderColor) and Zod schemas
- [✓] 2026-01-20 23:25 - Add unit tests for folder types/schemas (43 tests) in folder.types.test.ts
- [✓] 2026-01-20 23:28 - Create folder.api.ts with tRPC query/mutation options (getAllFoldersQueryOptions, getFoldersQueryKey, create/update/delete/reorder mutation options)

- [✓] 2026-01-20 23:44 - Create folder.hooks.ts with useFolderStorage React hook (dual-mode: localStorage for guests, tRPC for authenticated)
- [✓] 2026-01-20 23:44 - Implement optimistic updates for folder CRUD operations (create, update, delete, reorder)
- [✓] 2026-01-20 23:44 - Add unit tests for folder hooks (20 tests) in folder.hooks.test.tsx
- [✓] 2026-01-20 23:44 - Create local-folder-storage.ts for localStorage folder management (getAll, create, update, delete, reorder, clearAll)
- [✓] 2026-01-20 23:44 - Fix RemoteFolder type to use createdAt: string (ISO serialization over JSON)
- [✓] 2026-01-20 23:47 - Create folder barrel export (apps/web/src/app/api/folder/index.ts) with types, schemas, API functions, and hooks
- [✓] 2026-01-20 23:50 - Add unit tests for local folder storage (35 tests) in apps/web/src/lib/local-folder-storage.test.ts

- [✓] 2026-01-20 23:53 - Create FolderSidebar component (apps/web/src/components/folders/folder-sidebar.tsx) with folder list, inbox, color indicators, and dropdown actions
- [✓] 2026-01-20 23:53 - Add unit tests for FolderSidebar (45 tests) in apps/web/src/components/folders/folder-sidebar.test.tsx

- [✓] 2026-01-21 00:00 - Create Dialog UI component (apps/web/src/components/ui/dialog.tsx) using @base-ui/react/dialog
- [✓] 2026-01-21 00:02 - Create FolderCreateDialog component (apps/web/src/components/folders/folder-create-dialog.tsx) with name input, color picker, and live preview
- [✓] 2026-01-21 00:02 - Add unit tests for FolderCreateDialog (78 tests) in apps/web/src/components/folders/folder-create-dialog.test.tsx

- [✓] 2026-01-21 00:17 - Create FolderEditDialog component (apps/web/src/components/folders/folder-edit-dialog.tsx) with name/color editing, delete confirmation, and live preview
- [✓] 2026-01-21 00:17 - Add unit tests for FolderEditDialog (96 tests) in apps/web/src/components/folders/folder-edit-dialog.test.tsx

- [✓] 2026-01-21 00:32 - Update todo list component (apps/web/src/app/todos/page.tsx) to integrate folder sidebar with filtering
- [✓] 2026-01-21 00:32 - Add folderId support to Todo types (apps/web/src/app/api/todo/todo.types.ts) with SelectedFolderId type
- [✓] 2026-01-21 00:32 - Update useTodoStorage hook to handle folder filtering with selectedFolderId state and filteredTodos
- [✓] 2026-01-21 00:32 - Add updateFolder mutation to todo hooks for moving todos between folders
- [✓] 2026-01-21 00:32 - Update local-todo-storage.ts to support folderId in create and updateFolder operations
- [✓] 2026-01-21 00:32 - Add unit tests for folder filtering in todo hooks (32 tests) testing selectedFolderId, filteredTodos, and updateFolder

- [✓] 2026-01-21 00:51 - Create E2E tests for folder CRUD (25 tests) in apps/web/e2e/folders.spec.ts:
  - Create folder with name and color
  - Edit folder name and color
  - Delete folder with confirmation
  - Move todos to Inbox when folder is deleted
  - Assign todos to folders
  - Filter todos by folder
  - Persist folders after page reload
  - Multiple folders management
  - Empty state handling
- [✓] 2026-01-21 00:51 - Add clearFolderFromTodos function to local-todo-storage.ts to move todos to Inbox when folder is deleted
- [✓] 2026-01-21 00:51 - Update folder hooks to clear todo folderId when folder is deleted in localStorage mode
- [✓] 2026-01-21 00:51 - Export notifyLocalTodosListeners from todo hooks for cross-module notifications

- [✓] 2026-01-21 01:05 - Create subtask router (packages/api/src/routers/subtask.ts) with CRUD procedures: list, create, update, delete, toggle, reorder
- [✓] 2026-01-21 01:05 - Add Zod validation schemas for subtask inputs (createSubtaskInputSchema, updateSubtaskInputSchema, deleteSubtaskInputSchema, toggleSubtaskInputSchema, reorderSubtaskInputSchema, listSubtasksInputSchema)
- [✓] 2026-01-21 01:05 - Add logic to auto-complete parent todo when all subtasks are completed (checkAndAutoCompleteTodo helper)
- [✓] 2026-01-21 01:05 - Add subtask router to main tRPC router (packages/api/src/routers/index.ts)
- [✓] 2026-01-21 01:05 - Add unit tests for subtask router (61 tests) in packages/api/src/routers/subtask.test.ts covering:
  - Input validation for all subtask operations
  - Authorization and ownership verification logic
  - CRUD operations business logic
  - Auto-complete parent todo logic when all subtasks completed

- [✓] 2026-01-21 01:16 - Create subtask.types.ts (apps/web/src/app/api/subtask/subtask.types.ts) with:
  - Unified Subtask type supporting both local (string UUID) and remote (numeric) IDs
  - RemoteSubtask and LocalSubtask interfaces for storage-specific types
  - Zod schemas for remote operations: createSubtaskInputSchema, updateSubtaskInputSchema, deleteSubtaskInputSchema, toggleSubtaskInputSchema, reorderSubtaskInputSchema, listSubtasksInputSchema
  - Zod schemas for local operations: localCreateSubtaskInputSchema, localUpdateSubtaskInputSchema, localDeleteSubtaskInputSchema, localToggleSubtaskInputSchema, localReorderSubtaskInputSchema, localListSubtasksInputSchema
  - UseSubtaskStorageReturn hook return type
  - SubtaskProgress interface and helper functions (calculateSubtaskProgress, areAllSubtasksCompleted)
- [✓] 2026-01-21 01:16 - Add unit tests for subtask types/schemas (69 tests) in apps/web/src/app/api/subtask/subtask.types.test.ts covering:
  - All remote Zod schemas validation (create, update, delete, toggle, reorder, list)
  - All local Zod schemas validation with string IDs
  - SubtaskProgress helper function tests
  - areAllSubtasksCompleted helper function tests

- [✓] 2026-01-21 01:19 - Create subtask.api.ts (apps/web/src/app/api/subtask/subtask.api.ts) with:
  - getSubtasksQueryOptions(input: ListSubtasksInput) for fetching subtasks by todoId
  - getSubtasksQueryKey(todoId: number) for cache key generation
  - getCreateSubtaskMutationOptions() for creating subtasks
  - getUpdateSubtaskMutationOptions() for updating subtask text
  - getDeleteSubtaskMutationOptions() for deleting subtasks
  - getToggleSubtaskMutationOptions() for toggling completion status
  - getReorderSubtaskMutationOptions() for reordering subtasks
- [✓] 2026-01-21 01:19 - Add unit tests for subtask API (16 tests) in apps/web/src/app/api/subtask/subtask.api.test.ts covering:
  - Query options structure and function exports
  - Mutation options structure for all CRUD operations
  - Query key generation with todoId parameter

- [✓] 2026-01-21 01:34 - Create subtask.hooks.ts (apps/web/src/app/api/subtask/subtask.hooks.ts) with:
  - useSubtaskStorage hook for dual-mode subtask management (localStorage for guests, tRPC for authenticated)
  - useSyncExternalStore pattern for local subtask state with per-todoId caching
  - Optimistic updates for all CRUD operations (create, update, toggle, delete, reorder)
  - notifyLocalSubtasksListeners function for cross-module state updates
- [✓] 2026-01-21 01:34 - Create local-subtask-storage.ts (apps/web/src/lib/local-subtask-storage.ts) with:
  - getAll(todoId) - get subtasks for a specific todo
  - create(todoId, text) - create new subtask
  - update(id, text) - update subtask text
  - toggle(id, completed) - toggle completion status
  - deleteSubtask(id) - delete subtask
  - reorder(id, newOrder) - reorder subtask within todo
  - deleteByTodoId(todoId) - delete all subtasks for a todo
  - clearAll() - clear all subtasks
  - getById(id) - get subtask by ID
- [✓] 2026-01-21 01:34 - Add unit tests for subtask hooks (24 tests) in apps/web/src/app/api/subtask/subtask.hooks.test.tsx covering:
  - Authentication state detection
  - Guest mode localStorage operations (CRUD, reorder)
  - Authenticated mode behavior
  - Dual-mode switching on login
  - Loading state management
  - Subtask normalization and sorting by order
  - TodoId filtering
  - Error handling for non-existent subtasks
  - External store pattern stability

- [✓] 2026-01-21 01:48 - Create subtask barrel export (apps/web/src/app/api/subtask/index.ts) with:
  - API exports: query options and mutation options for subtask CRUD operations
  - Hook exports: useSubtaskStorage and notifyLocalSubtasksListeners
  - Type exports: all subtask types (Subtask, RemoteSubtask, LocalSubtask, etc.)
  - Schema exports: all Zod validation schemas for remote and local operations
  - Helper exports: calculateSubtaskProgress and areAllSubtasksCompleted utilities

- [✓] 2026-01-21 01:51 - Update local-todo-storage.ts to integrate with subtask storage:
  - Added import for local-subtask-storage module
  - Updated deleteTodo() to call localSubtaskStorage.deleteByTodoId() to delete associated subtasks when a todo is deleted
- [✓] 2026-01-21 01:51 - Add unit tests for local-todo-storage (48 tests) in apps/web/src/lib/local-todo-storage.test.ts covering:
  - getAll(): empty state, validation of todo structure, field type checking, folderId handling, SSR safety
  - create(): default values, folderId support, UUID generation, appending to existing todos
  - toggle(): completion state toggling, persistence, non-existent todo handling
  - deleteTodo(): todo removal, subtask cascade deletion via localSubtaskStorage.deleteByTodoId()
  - updateFolder(): folderId updates, move to Inbox (null), persistence
  - clearAll(): localStorage removal, SSR safety
  - clearFolderFromTodos(): batch folderId clearing when folder is deleted

- [✓] 2026-01-21 02:10 - Create SubtaskList component (apps/web/src/components/subtasks/subtask-list.tsx) with:
  - SubtaskList component using useSubtaskStorage hook for dual-mode support
  - StandaloneSubtaskList component for direct subtask prop passing (useful for testing)
  - Checkbox toggle for subtask completion with accessible labels
  - Delete button for each subtask with confirmation
  - Loading skeleton state during data fetch
  - Empty state message when no subtasks exist
  - Completed styling with strikethrough text
  - Read-only mode support (disables checkboxes and hides delete buttons)
  - onAllCompleted and onUncompleted callbacks for auto-complete parent todo logic
  - Support for both string (local) and numeric (remote) subtask IDs
- [✓] 2026-01-21 02:10 - Add unit tests for SubtaskList (35 tests) in apps/web/src/components/subtasks/subtask-list.test.tsx covering:
  - Rendering: empty state, subtask list, custom className
  - Loading state: skeleton display and hiding
  - Checkbox toggle: checkbox rendering, checked state, toggle callback
  - Delete subtask: button rendering, delete callback, accessible name
  - Completed styling: strikethrough for completed, no strikethrough for incomplete
  - Read-only mode: hidden delete buttons, disabled checkboxes (aria-disabled)
  - Auto-complete callbacks: onAllCompleted when all done, onUncompleted when unchecked
  - Accessibility: list landmark, semantic list items, checkbox labels
  - Numeric IDs: handling numeric subtask IDs, toggle/delete with numeric IDs
  - StandaloneSubtaskList: rendering, loading, interactions, callbacks, read-only mode

- [✓] 2026-01-21 02:25 - Create SubtaskItem component (apps/web/src/components/subtasks/subtask-item.tsx) with:
  - Extracted from SubtaskList as a reusable component
  - Checkbox for completion toggle with accessible label
  - Delete button with accessible label (hidden on hover until focused/hovered)
  - Strikethrough and muted text styling for completed subtasks
  - Read-only mode support (disables checkbox, hides delete button)
  - Support for both string (local) and numeric (remote) subtask IDs
  - Custom className support
- [✓] 2026-01-21 02:25 - Add unit tests for SubtaskItem (30 tests) in apps/web/src/components/subtasks/subtask-item.test.tsx covering:
  - Rendering: subtask text, data-testid attributes, custom className, numeric IDs
  - Checkbox: unchecked/checked states, toggle callback, accessible labels
  - Delete button: rendering, click callback, accessible label
  - Completed styling: strikethrough, muted text color
  - Read-only mode: hidden delete button, disabled checkbox, styling preserved
  - Accessibility: list item element, keyboard accessible button
  - Edge cases: empty text, long text, special characters, unicode
- [✓] 2026-01-21 02:25 - Updated SubtaskList to import SubtaskItem from separate file for better code organization

- [✓] 2026-01-21 02:44 - Create SubtaskAddInput component (apps/web/src/components/subtasks/subtask-add-input.tsx) with:
  - Text input with placeholder for new subtask text
  - Add button with Plus icon for submission
  - Enter key submission support (with Shift+Enter passthrough)
  - Loading/submitting state that disables input and button
  - Auto-clear input after successful submission
  - Whitespace trimming before submission
  - Custom className and placeholder support
  - AutoFocus option
  - Accessible with proper ARIA labels (input: "New subtask text", button: "Add subtask")
- [✓] 2026-01-21 02:44 - Add unit tests for SubtaskAddInput (34 tests) in apps/web/src/components/subtasks/subtask-add-input.test.tsx covering:
  - Rendering: input, button, placeholders, className
  - Input interaction: typing, clearing after submit, whitespace trimming
  - Enter key submission: submit on Enter, no submit on Shift+Enter, preventDefault
  - Button submission: click handler, disabled states (empty, whitespace)
  - Disabled state: input and button disabled, no submission
  - Async submission: promise handling, double submission prevention, disabled during async
  - AutoFocus: default off, enabled when prop is true
  - Accessibility: input label, button label, keyboard navigation
  - Edge cases: long text, special characters, unicode, rapid submissions

- [✓] 2026-01-21 03:02 - Create SubtaskProgressIndicator component (apps/web/src/components/subtasks/subtask-progress-indicator.tsx) with:
  - Display of completed/total subtask count (e.g., "2/5")
  - CheckSquare icon with optional display
  - Green styling when all subtasks completed, muted otherwise
  - Two size variants (sm, md) for different contexts
  - Uses semantic <output> element for accessibility
  - Proper aria-label describing progress
  - Returns null when no subtasks exist (total === 0)
- [✓] 2026-01-21 03:02 - Add unit tests for SubtaskProgressIndicator (26 tests) in apps/web/src/components/subtasks/subtask-progress-indicator.test.tsx covering:
  - Rendering: progress text, data-testid, icon visibility, className
  - Empty state: returns null when total is 0
  - Completion styling: green when all completed, muted otherwise
  - Size variants: sm (text-xs, h-3 icon), md (text-sm, h-4 icon)
  - Accessibility: aria-label, aria-hidden on icon
  - Progress values: various counts including edge cases
  - Icon styling: color based on completion state
- [✓] 2026-01-21 03:02 - Add getAllGroupedByTodoId function to local-subtask-storage.ts for efficient subtask progress tracking across multiple todos
- [✓] 2026-01-21 03:02 - Create useAllSubtasksProgress hook (apps/web/src/app/api/subtask/subtask-progress.hooks.ts) with:
  - useSyncExternalStore pattern for reactive localStorage updates
  - Map<string, SubtaskProgress> for efficient lookup by todoId
  - getProgress(todoId) helper function
  - Notifies listeners when subtasks change via notifyAllSubtasksListeners
- [✓] 2026-01-21 03:02 - Integrate SubtaskProgressIndicator into todos page:
  - Added useAllSubtasksProgress hook to get progress for all todos
  - Display progress indicator on each todo item showing "X/Y" subtask completion
  - Created barrel export for subtasks components (apps/web/src/components/subtasks/index.ts)
  - Updated subtask.hooks.ts to notify all-subtasks listeners on local storage changes

- [✓] 2026-01-21 03:20 - Create TodoExpandableItem component (apps/web/src/components/todos/todo-expandable-item.tsx) with:
  - Expand/collapse toggle button with ChevronDown icon
  - Subtask list and add input shown inline when expanded
  - Auto-complete parent todo when all subtasks completed (onAllCompleted callback)
  - Auto-uncomplete parent todo when subtask unchecked (onUncompleted callback)
  - Folder badge display with color classes support
  - Subtask progress indicator integration
  - Accessible with aria-expanded and aria-label attributes
  - Support for both local (string) and remote (numeric) todo IDs
- [✓] 2026-01-21 03:20 - Add unit tests for TodoExpandableItem (41 tests) in apps/web/src/components/todos/todo-expandable-item.test.tsx covering:
  - Rendering: todo text, data-testid, toggle/expand/delete buttons, className, animation delay
  - Completed state: checked/unchecked styling, strikethrough text
  - Toggle interaction: onToggle callback with id and completed state
  - Delete interaction: onDelete callback with id
  - Expand/collapse: default collapsed, expand on click, collapse on second click, aria-expanded
  - Folder badge: conditional display based on showFolderBadge and folder props
  - Subtask progress: conditional display based on subtaskProgress prop
  - Adding subtasks: create callback when subtask added
  - Auto-complete logic: callbacks passed to SubtaskList
  - Accessibility: aria-labels for all buttons, list item element
  - Edge cases: empty text, long text, special characters, unicode
- [✓] 2026-01-21 03:20 - Create barrel export for todos components (apps/web/src/components/todos/index.ts)
- [✓] 2026-01-21 03:20 - Update todos page to use TodoExpandableItem for inline subtask management

- [✓] 2026-01-21 03:45 - Create E2E tests for subtask CRUD (26 tests) in apps/web/e2e/subtasks.spec.ts covering:
  - Add subtasks to a todo (single/multiple/to different todos)
  - Toggle subtask completion (check/uncheck)
  - Delete a subtask (single/with confirmation)
  - Auto-complete parent todo when all subtasks completed
  - Uncheck parent todo when subtask unchecked
  - Show subtask progress indicator (e.g., "2/5")
  - Persist subtasks after page reload
  - Expand/collapse subtask sections
  - Keyboard navigation (Enter key submission)
  - Empty subtask input handling

- [✓] 2026-01-21 03:55 - Update todo router (packages/api/src/routers/todo.ts) to handle scheduling fields:
  - Added dueDate, reminderAt, recurringPattern fields to create procedure input schema
  - Added dueDate, reminderAt, recurringPattern fields to bulkCreate procedure input schema
  - Created recurringPatternSchema Zod validation for cron-style recurring patterns
  - Created updateSchedule procedure to update scheduling fields on existing todos
  - Created getDueInRange procedure to query todos due within a time range
  - Scheduling fields converted from ISO datetime strings to Date objects for database storage
- [✓] 2026-01-21 03:55 - Add unit tests for scheduling fields in todo router (85 total tests) covering:
  - RecurringPattern schema validation (daily, weekly, monthly, yearly, custom patterns)
  - Create todo with scheduling input validation
  - UpdateSchedule input validation
  - GetDueInRange input validation
  - Scheduling business logic (date conversion, update data preparation, filtering by date range, bulk create with scheduling)

- [✓] 2026-01-21 04:15 - Create packages/api/src/lib/recurring.ts with cron-style pattern parsing and next occurrence calculation:
  - recurringPatternSchema Zod schema for validating recurring patterns
  - RecurringPattern TypeScript type
  - isPatternExpired() function to check if pattern has reached end conditions (endDate or max occurrences)
  - getNextOccurrence() function to calculate next occurrence date for any pattern type
  - Support for daily, weekly (with specific days), monthly (with specific day of month), yearly, and custom patterns
  - Support for intervals (every N days/weeks/months/years)
  - parseRecurringDescription() function to parse human-readable descriptions like "every Monday", "daily", "every 2 weeks"
  - formatRecurringPattern() function to format patterns as human-readable strings
- [✓] 2026-01-21 04:15 - Add unit tests for recurring pattern logic (99 tests) in packages/api/src/lib/recurring.test.ts covering:
  - Schema validation for all pattern types and fields
  - isPatternExpired() with endDate and occurrences limits
  - getNextOccurrence() for daily, weekly, monthly, yearly, and custom patterns
  - Weekly patterns with specific days of week
  - Monthly patterns with day-of-month handling (including months with fewer days)
  - Yearly patterns with month and day specification
  - Pattern interval handling
  - End condition checks (endDate and occurrences)
  - parseRecurringDescription() for various natural language inputs
  - formatRecurringPattern() for human-readable output

- [✓] 2026-01-21 04:25 - Add completeRecurring procedure to todo router (packages/api/src/routers/todo.ts) with:
  - Marks current recurring todo as completed
  - Calculates next occurrence date using getNextOccurrence utility
  - Creates new todo for next occurrence if pattern hasn't expired
  - Preserves reminder offset (time between reminder and due date) in new todo
  - Returns { completed: true, nextTodo: <new todo> | null, message }
  - Handles pattern expiration (endDate or max occurrences reached)
  - Input validation for id (required) and completedOccurrences (optional, non-negative integer)
- [✓] 2026-01-21 04:25 - Add unit tests for completeRecurring procedure (24 tests) in packages/api/src/routers/todo.test.ts covering:
  - Input validation (id required, completedOccurrences optional and non-negative)
  - Todo ownership verification (NOT_FOUND for missing or unauthorized todos)
  - Recurring pattern validation (BAD_REQUEST if no pattern)
  - Next occurrence calculation logic for daily patterns
  - Pattern expiration detection (max occurrences, end date)
  - Reminder offset preservation when creating next occurrence
  - New todo creation data structure
  - Return value structure (completed, nextTodo, message)
  - Base date selection (use dueDate or current date)

- [✓] 2026-01-21 04:45 - Update todo.types.ts with scheduling fields (apps/web/src/app/api/todo/todo.types.ts):
  - Added RecurringPattern Zod schema and TypeScript type matching backend schema
  - Added RECURRING_PATTERN_TYPES constant array with all pattern types (daily, weekly, monthly, yearly, custom)
  - Updated Todo, RemoteTodo, and LocalTodo interfaces to include optional scheduling fields (dueDate, reminderAt, recurringPattern)
  - Added scheduling fields to createTodoInputSchema (dueDate, reminderAt, recurringPattern with datetime validation)
  - Added scheduling fields to bulkCreateTodosInputSchema for batch todo creation
  - Created updateTodoScheduleInputSchema for updating scheduling fields on existing todos
  - Created getDueInRangeInputSchema for querying todos by date range
  - Created completeRecurringInputSchema for completing recurring todos with occurrence tracking
  - Created local storage schemas: localCreateTodoInputSchema, localToggleTodoInputSchema, localDeleteTodoInputSchema, localUpdateTodoFolderInputSchema, localUpdateTodoScheduleInputSchema
  - Added all new input types: UpdateTodoScheduleInput, GetDueInRangeInput, CompleteRecurringInput, and local variants
  - Added CompleteRecurringOutput interface for recurring completion response
  - Updated UseTodoStorageReturn interface to include updateSchedule function and scheduling parameter in create function
- [✓] 2026-01-21 04:45 - Add unit tests for todo types (102 tests) in apps/web/src/app/api/todo/todo.types.test.ts covering:
  - RecurringPattern schema validation (type, interval, daysOfWeek, dayOfMonth, monthOfYear, endDate, occurrences)
  - RECURRING_PATTERN_TYPES constant validation
  - Remote input schemas: createTodoInputSchema, toggleTodoInputSchema, deleteTodoInputSchema, bulkCreateTodosInputSchema, updateTodoFolderInputSchema, updateTodoScheduleInputSchema, getDueInRangeInputSchema, completeRecurringInputSchema
  - Local input schemas: localCreateTodoInputSchema, localToggleTodoInputSchema, localDeleteTodoInputSchema, localUpdateTodoFolderInputSchema, localUpdateTodoScheduleInputSchema
  - Datetime validation for scheduling fields
  - Boundary validation (dayOfMonth 1-31, monthOfYear 1-12, daysOfWeek 0-6)
- [✓] 2026-01-21 04:45 - Updated related files to support new scheduling types:
  - Updated todo.api.ts: added getUpdateTodoScheduleMutationOptions function
  - Updated todo.hooks.ts: added RecurringPattern import, scheduling fields to optimistic create, updateScheduleMutation with optimistic updates, updateSchedule callback function
  - Updated todo.utils.ts: added recurringPattern field to createOptimisticTodo
  - Updated todo.utils.test.ts: added recurringPattern: null to all RemoteTodo test fixtures
  - Updated local-todo-storage.ts: added RecurringPattern interface, scheduling fields to LocalTodo, extended type guard, added updateSchedule function

- [✓] 2026-01-21 04:58 - Update todo.api.ts with scheduling query options (apps/web/src/app/api/todo/todo.api.ts):
  - Added getDueInRangeQueryOptions(input: GetDueInRangeInput) for fetching todos due within a date range
  - Added getDueInRangeQueryKey(input: GetDueInRangeInput) for cache key generation
  - Added getCompleteRecurringMutationOptions() for completing recurring todos
  - Added import for GetDueInRangeInput type from todo.types.ts
- [✓] 2026-01-21 04:58 - Create unit tests for todo.api.ts (26 tests) in apps/web/src/app/api/todo/todo.api.test.ts covering:
  - Query options: getAllTodosQueryOptions, getTodosQueryKey, getDueInRangeQueryOptions, getDueInRangeQueryKey
  - Mutation options: create, toggle, delete, bulkCreate, updateFolder, updateSchedule, completeRecurring
  - Query key generation with date range parameters
  - Module exports verification
- [✓] 2026-01-21 04:58 - Fix todo.hooks.test.tsx mock to include getUpdateTodoScheduleMutationOptions

- [✓] 2026-01-21 05:03 - Update todo.hooks.ts to handle scheduling in optimistic updates:
  - Updated create callback to accept optional scheduling parameter (dueDate, reminderAt, recurringPattern)
  - Pass scheduling fields to remote createMutation.mutateAsync for authenticated mode
  - Pass scheduling fields to localTodoStorage.create for guest mode
  - Updated todos mapping to include scheduling fields (dueDate, reminderAt, recurringPattern)
  - Cast recurringPattern from unknown to RecurringPattern type for remote todos
- [✓] 2026-01-21 05:03 - Update local-todo-storage.ts create function to accept scheduling parameter:
  - Extended create function signature with optional scheduling object parameter
  - Store dueDate, reminderAt, recurringPattern fields when creating new local todos
- [✓] 2026-01-21 05:03 - Add unit tests for scheduling hooks (17 new tests) in todo.hooks.test.tsx covering:
  - Create Todo with Scheduling (Guest Mode): dueDate, reminderAt, recurringPattern, all fields, folderId+scheduling, null defaults
  - Update Schedule (Guest Mode): dueDate, reminderAt, recurringPattern, multiple fields, clearing to null
  - Todos Include Scheduling Fields: from localStorage, normalize undefined to null, filteredTodos preserves fields
- [✓] 2026-01-21 05:03 - Fix existing test "normalizes local todos to unified format" to include scheduling fields in expected output

- [✓] 2026-01-21 05:25 - Create DatePicker component (apps/web/src/components/scheduling/date-picker.tsx) with:
  - Popover-based calendar picker using @base-ui/react/popover
  - Quick presets (Today, Tomorrow, Next week) with customizable presets support
  - Full calendar grid with month navigation (previous/next month)
  - Year boundary navigation support
  - Selected date highlighting with aria-pressed state
  - Today's date indicator with aria-current
  - Min/max date constraints with disabled state
  - Clearable value with separate clear button
  - Accessible with proper aria-labels and keyboard navigation
  - Helper functions exported: formatDate, isSameDay, getDaysInMonth, getFirstDayOfMonth
- [✓] 2026-01-21 05:25 - Add unit tests for DatePicker (64 tests) in apps/web/src/components/scheduling/date-picker.test.tsx covering:
  - Rendering: trigger, placeholder, calendar icon, formatted dates, clear button, className
  - Disabled state: trigger disabled, hidden clear button
  - Popover behavior: open/close, presets section, custom presets, calendar navigation, calendar grid
  - Calendar navigation: previous/next month, year boundary crossing
  - Date selection: onChange callback, popover close, selected date highlighting, today highlighting
  - Preset selection: Today, Tomorrow, Next week presets with correct date calculation
  - Clear functionality: clearing value, preventing popover open on clear
  - Min/max constraints: disabling out-of-range dates, preventing onChange for disabled dates
  - Accessibility: trigger labels, clear button label, navigation labels, calendar grid label
  - Helper functions: formatDate, isSameDay, getDaysInMonth, getFirstDayOfMonth
  - DEFAULT_DATE_PRESETS: preset labels and date calculations

- [✓] 2026-01-21 05:30 - Create ReminderPicker component (apps/web/src/components/scheduling/reminder-picker.tsx) with:
  - Popover-based reminder offset selector using @base-ui/react/popover
  - Default offsets: At time, 15 min before, 30 min before, 1 hour before, 2 hours before, 1 day before
  - Custom offsets support via offsets prop
  - Disabled when no due date is set (requires due date to calculate reminder)
  - Selected offset highlighting with aria-pressed state
  - Clearable value with separate clear button
  - Helper functions: calculateReminderDate, calculateOffsetMinutes, formatReminderOffset, formatReminderTime, findClosestOffset
  - Accessible with proper aria-labels and keyboard navigation
- [✓] 2026-01-21 05:30 - Add unit tests for ReminderPicker (73 tests) in apps/web/src/components/scheduling/reminder-picker.test.tsx covering:
  - Rendering: trigger, placeholder, bell icon, formatted reminder, clear button, className
  - Disabled state: trigger disabled when disabled=true, trigger disabled when no due date
  - Popover behavior: open/close, offset options, custom offsets, no due date message, no offsets message
  - Offset selection: onChange callback, popover close, selected offset highlighting
  - Clear functionality: clearing value, preventing popover open on clear
  - Accessibility: trigger labels, clear button label, offset aria-pressed, hidden icons
  - Display values: formatted offsets for various durations
  - Helper functions: calculateReminderDate, calculateOffsetMinutes, formatReminderOffset, formatReminderTime, findClosestOffset
  - DEFAULT_REMINDER_OFFSETS: offset labels and values

- [✓] 2026-01-21 05:46 - Create RecurringPicker component (apps/web/src/components/scheduling/recurring-picker.tsx) with:
  - Popover-based recurring pattern selector using @base-ui/react/popover
  - Default presets: Daily, Weekly, Weekdays (Mon-Fri), Monthly, Yearly
  - Custom presets support via presets prop
  - Full custom pattern builder with pattern type selector dropdown
  - Interval input (every N days/weeks/months/years)
  - Day selector for weekly/custom patterns (Sun-Sat toggleable buttons)
  - Day of month input for monthly patterns (1-31)
  - Apply button to confirm custom pattern
  - Selected preset highlighting with aria-pressed state
  - Clearable value with separate clear button
  - Helper functions: formatRecurringPattern, formatOrdinal, patternsEqual
  - Accessible with proper aria-labels and keyboard navigation
- [✓] 2026-01-21 05:46 - Add unit tests for RecurringPicker (119 tests) in apps/web/src/components/scheduling/recurring-picker.test.tsx covering:
  - Rendering: trigger, placeholder, repeat icon, formatted pattern, clear button, className
  - Disabled state: trigger disabled when disabled=true, hidden clear button
  - Popover behavior: open/close, presets section, custom presets, custom builder section
  - Preset selection: onChange callback, popover close, selected preset highlighting
  - Pattern type selector: dropdown behavior, type switching, type-specific fields
  - Interval input: default value, changing value, unit labels (singular/plural)
  - Day selector (weekly/custom): showing/hiding, all 7 days, selected days highlighting, toggle behavior
  - Day of month input (monthly): showing/hiding, entering value
  - Apply button: onChange with custom pattern, popover close
  - Clear functionality: clearing value, preventing popover open on clear
  - Accessibility: trigger labels, clear button label, day buttons aria-pressed/aria-label, input labels
  - Display values: formatted patterns for all types (daily, weekly, weekdays, weekends, monthly, yearly, custom)
  - Helper functions: formatRecurringPattern, formatOrdinal, patternsEqual
  - Constants: DEFAULT_RECURRING_PRESETS, PATTERN_TYPE_LABELS, DAY_LABELS, FULL_DAY_LABELS

- [✓] 2026-01-21 06:00 - Create TodoSchedulePopover component (apps/web/src/components/scheduling/todo-schedule-popover.tsx) with:
  - Popover-based combined scheduling selector using @base-ui/react/popover
  - Integrates DatePicker, ReminderPicker, and RecurringPicker components
  - ScheduleValue interface for unified schedule state (dueDate, reminderAt, recurringPattern)
  - Section-based layout with Due date, Reminder, and Repeat sections
  - Summary section showing current schedule configuration
  - Clear all button to reset entire schedule
  - Compact mode for icon-only trigger
  - Auto-clears reminder when due date is cleared (since reminder is relative to due date)
  - Reminder hint shown when no due date is set
  - Custom presets support for all three pickers (datePresets, reminderOffsets, recurringPresets)
  - Min/max date constraints passthrough to DatePicker
  - Helper functions: formatScheduleValue, hasSchedule, emptyScheduleValue
  - Accessible with proper aria-labels and keyboard navigation
- [✓] 2026-01-21 06:00 - Add unit tests for TodoSchedulePopover (55 tests) in apps/web/src/components/scheduling/todo-schedule-popover.test.tsx covering:
  - Rendering: trigger, placeholder, calendar icon, formatted schedule, clear button, className
  - Combined display: due date only, recurring only, both combined with separator
  - Compact mode: icon-only trigger, hidden clear button, aria-label preserved
  - Disabled state: trigger disabled, hidden clear button
  - Popover behavior: open/close, header, sections (due date, reminder, recurring), reminder hint
  - Summary section: due date display, reminder display, recurring display
  - Clear functionality: clear button, clear all button, no popover open on clear
  - Due date changes: onChange callback, clears reminder when due date cleared
  - Recurring pattern changes: onChange callback
  - Accessibility: trigger labels, clear button label
  - Helper functions: formatScheduleValue, hasSchedule, emptyScheduleValue
  - Edge cases: reminder without due date, complex recurring patterns, weekdays pattern

- [✓] 2026-01-21 06:20 - Create DueDateBadge component (apps/web/src/components/scheduling/due-date-badge.tsx) with:
  - Due date display with smart formatting ("Today", "Tomorrow", "Yesterday", weekday for next 7 days)
  - Overdue styling (red background/text) for past due dates on incomplete todos
  - Today styling (accent color) for todos due today
  - Recurring pattern indicator with icon
  - Helper functions: isOverdue, isToday, isTomorrow, formatDueDate
  - Completed state styling with muted colors
- [✓] 2026-01-21 06:20 - Add unit tests for DueDateBadge (41 tests) in apps/web/src/components/scheduling/due-date-badge.test.tsx covering:
  - Rendering: badge, calendar icon, date text, className
  - Date display: Today, Tomorrow, Yesterday, weekday, month/day
  - Overdue styling: past due incomplete, past due completed, future dates, today
  - Today styling: today vs other dates
  - Completed styling: muted colors for completed todos
  - Recurring patterns: icon display, indicator with date, text without date
  - Helper functions: isOverdue, isToday, isTomorrow, formatDueDate
- [✓] 2026-01-21 06:20 - Update TodoExpandableItem component to show due date badge and overdue styling:
  - Added dueDate and recurringPattern fields to todo prop interface
  - Added overdue detection using isOverdue helper
  - Added red border/background styling for overdue todos (data-overdue attribute)
  - Integrated DueDateBadge component in badges section
- [✓] 2026-01-21 06:20 - Add unit tests for due date display in TodoExpandableItem (13 tests) covering:
  - Due Date Badge: no badge when no date, badge when date provided, badge with recurring only
  - Date display: Today, Tomorrow formatting
  - Overdue styling: past due incomplete, past due completed, future dates, today
  - Recurring pattern display: indicator with date, text without date
- [✓] 2026-01-21 06:20 - Export RecurringPattern and RecurringPatternType from todo index.ts barrel file

- [✓] 2026-01-21 06:45 - Integrate TodoSchedulePopover into TodoExpandableItem component (apps/web/src/components/todos/todo-expandable-item.tsx):
  - Added onScheduleChange callback prop for updating todo schedule
  - Added scheduleValue computation to convert ISO strings to Date objects
  - Added handleScheduleChange to serialize Date objects back to ISO strings
  - Added TodoSchedulePopover in action buttons section (compact mode, shows on hover)
  - Added reminderAt field to todo prop interface
- [✓] 2026-01-21 06:45 - Update todos page to pass onScheduleChange and updateSchedule (apps/web/src/app/todos/page.tsx):
  - Extract updateSchedule from useTodoStorage hook
  - Add handleScheduleChange handler function
  - Pass onScheduleChange to TodoExpandableItem
- [✓] 2026-01-21 06:45 - Create E2E tests for scheduling (26 tests) in apps/web/e2e/scheduling.spec.ts:
  - Set due date using date picker: calendar day selection, month navigation
  - Set due date using presets: Today, Tomorrow, Next week
  - Clear due date: using clear button, using Clear all button
  - Set reminder time: hint when no due date, reminder after due date set, clear with due date
  - Create daily recurring todo: using preset, using custom builder with interval
  - Create weekly recurring todo: using preset, with specific days (M/W/F), weekdays preset
  - Create monthly recurring todo: using preset, on specific day (15th)
  - Show overdue styling: past-due incomplete, not for completed, not for future
  - Persist scheduling data after reload: due date, recurring pattern, combined schedule
  - Schedule display in todo list: due date badge, recurring indicator, combined display

- [✓] 2026-01-21 06:49 - Create use-notifications.ts hook (apps/web/src/hooks/use-notifications.ts) with:
  - NotificationPermission type ("default" | "granted" | "denied")
  - NotificationState interface (isSupported, permission, isRequesting)
  - UseNotificationsReturn interface extending state with requestPermission and showNotification methods
  - Pure functions for testability: isNotificationSupported, getNotificationPermission, deriveNotificationState, canShowNotification
  - useNotifications hook with permission polling (5s interval)
  - requestPermission() to prompt user for browser notification access
  - showNotification() to create browser Notification when granted
  - SSR-safe with client-side initialization
- [✓] 2026-01-21 06:49 - Add unit tests for useNotifications hook (43 tests) in apps/web/src/hooks/use-notifications.test.ts covering:
  - Pure functions: isNotificationSupported, getNotificationPermission, deriveNotificationState, canShowNotification
  - Initial state: isSupported detection, permission states (default/granted/denied), isRequesting
  - requestPermission: returns denied when unsupported, returns current when already granted/denied, calls Notification.requestPermission, updates state, handles errors
  - showNotification: returns null when unsupported/denied, creates Notification when granted, passes options, handles constructor errors
  - Permission polling: polls for changes, cleans up on unmount, skips when unsupported
  - Function stability: stable references across rerenders

- [✓] 2026-01-21 07:02 - Create use-reminder-checker.ts hook (apps/web/src/hooks/use-reminder-checker.ts) with:
  - DueReminder interface for tracking todo reminders that are due
  - ReminderCheckerOptions interface for configuration (checkInterval, tolerance, enabled)
  - UseReminderCheckerReturn interface with dueReminders, dismissReminder, dismissAllReminders, shownCount, isChecking
  - Pure functions for testability: isReminderDue, getDueReminders, getShownRemindersFromStorage, saveShownRemindersToStorage, markReminderAsShown, formatReminderNotificationBody, cleanupShownReminders
  - useReminderChecker hook with configurable polling interval (default 30s)
  - Shows browser notifications and calls onReminder callback when reminders are due
  - Tracks shown reminders in localStorage to prevent duplicates
  - SSR-safe with client-side initialization
  - Auto-cleans up shown reminders for completed/deleted todos
- [✓] 2026-01-21 07:02 - Add unit tests for useReminderChecker hook (61 tests) in apps/web/src/hooks/use-reminder-checker.test.ts covering:
  - Pure functions: isReminderDue (timing, tolerance, edge cases), getDueReminders (filtering, exclusions), storage functions (get/save/mark/cleanup)
  - formatReminderNotificationBody: overdue, hours, days, tomorrow, generic messages
  - Constants: DEFAULT_CHECK_INTERVAL (30s), DEFAULT_TOLERANCE (1min), SHOWN_REMINDERS_STORAGE_KEY
  - Hook tests (skipped due to environment memory constraints): initial state, reminder detection, dismiss functions, callback support, function stability, interval management
