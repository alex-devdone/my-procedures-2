# Ralphy Progress Log

- [✓] 2026-01-19 20:55 - Update todo schema to add userId foreign key
- [✓] 2026-01-19 20:56 - Run database migration
- [✓] 2026-01-19 20:59 - Update todo router to use protectedProcedure
- [✓] 2026-01-19 21:01 - Create auth client for frontend
- [✓] 2026-01-19 21:05 - Create login page
- [✓] 2026-01-19 21:05 - Create signup page
- [✓] 2026-01-19 21:06 - Create auth layout with protected routes
- [✓] 2026-01-19 21:07 - Create local storage service for todos
- [✓] 2026-01-19 21:11 - Create todo storage abstraction hook
- [✓] 2026-01-19 21:12 - Create header with auth state
- [✓] 2026-01-19 21:15 - Update todo components to use storage abstraction
- [✓] 2026-01-19 21:18 - Add sync local todos to database on login
- [✓] 2026-01-19 21:22 - Refactor to entity-based API structure
- [✓] 2026-01-19 21:24 - Update CLAUDE.md with entity-based API structure
- [✓] 2026-01-19 21:24 - Fix useSyncExternalStore infinite loop in todo.hooks.ts
- [✓] 2026-01-19 21:26 - Change default dev port to 4757
- [✓] 2026-01-19 21:39 - Redesign app UI/UX using frontend-design skill
- [✓] 2026-01-19 21:43 - Set up unit testing infrastructure
- [✓] 2026-01-19 21:50 - Extract business logic into testable hooks/utilities
- [✓] 2026-01-19 21:58 - Write unit tests for business logic
- [✓] 2026-01-19 21:58 - Fix 403 INVALID_ORIGIN error in Better-Auth

- [✓] 2026-01-19 22:15 - Set up Playwright for E2E testing
- [✓] 2026-01-19 23:19 - Write E2E tests for todo CRUD operations
- [✓] 2026-01-19 23:35 - Fix todo toggle causing full list reload

- [✓] 2026-01-20 22:54 - Create folder schema (packages/db/src/schema/folder.ts) with id, name, color, userId, createdAt, order
- [✓] 2026-01-20 22:54 - Add unit tests for folder schema validation (packages/db/src/schema/folder.test.ts)
- [✓] 2026-01-20 22:57 - Update todo schema with scheduling fields (dueDate, reminderAt, recurringPattern, folderId) and indexes
- [✓] 2026-01-20 22:57 - Add unit tests for updated todo schema (packages/db/src/schema/todo.test.ts)
- [✓] 2026-01-20 23:01 - Create subtask schema (packages/db/src/schema/subtask.ts) with id, text, completed, todoId, order
- [✓] 2026-01-20 23:01 - Add unit tests for subtask schema (packages/db/src/schema/subtask.test.ts)
- [✓] 2026-01-20 23:03 - Update schema index to export folder and subtask schemas, add subtasks relation to todoRelations
- [✓] 2026-01-20 23:13 - Generate Drizzle migrations (0001_easy_sally_floyd.sql) for folder, subtask tables and todo scheduling fields
- [✓] 2026-01-20 23:25 - Apply database schema changes using db:push (folder, subtask tables and todo scheduling fields)

- [✓] 2026-01-20 23:21 - Create folder router (packages/api/src/routers/folder.ts) with CRUD procedures: list, create, update, delete, reorder
- [✓] 2026-01-20 23:21 - Add unit tests for folder router (packages/api/src/routers/folder.test.ts) with 58 tests
- [✓] 2026-01-20 23:21 - Add folder router to main tRPC router (packages/api/src/routers/index.ts)
- [✓] 2026-01-20 23:21 - Add Zod validation schemas for folder inputs (folderColorSchema, createFolderInputSchema, updateFolderInputSchema, deleteFolderInputSchema, reorderFolderInputSchema)
- [✓] 2026-01-20 23:21 - Add missing drizzle-orm exports (gt, gte, lt, lte) to packages/db/src/index.ts

- [✓] 2026-01-20 23:25 - Create folder.types.ts with TypeScript types (Folder, RemoteFolder, LocalFolder, FolderColor) and Zod schemas
- [✓] 2026-01-20 23:25 - Add unit tests for folder types/schemas (43 tests) in folder.types.test.ts
- [✓] 2026-01-20 23:28 - Create folder.api.ts with tRPC query/mutation options (getAllFoldersQueryOptions, getFoldersQueryKey, create/update/delete/reorder mutation options)

- [✓] 2026-01-20 23:44 - Create folder.hooks.ts with useFolderStorage React hook (dual-mode: localStorage for guests, tRPC for authenticated)
- [✓] 2026-01-20 23:44 - Implement optimistic updates for folder CRUD operations (create, update, delete, reorder)
- [✓] 2026-01-20 23:44 - Add unit tests for folder hooks (20 tests) in folder.hooks.test.tsx
- [✓] 2026-01-20 23:44 - Create local-folder-storage.ts for localStorage folder management (getAll, create, update, delete, reorder, clearAll)
- [✓] 2026-01-20 23:44 - Fix RemoteFolder type to use createdAt: string (ISO serialization over JSON)
- [✓] 2026-01-20 23:47 - Create folder barrel export (apps/web/src/app/api/folder/index.ts) with types, schemas, API functions, and hooks
- [✓] 2026-01-20 23:50 - Add unit tests for local folder storage (35 tests) in apps/web/src/lib/local-folder-storage.test.ts

- [✓] 2026-01-20 23:53 - Create FolderSidebar component (apps/web/src/components/folders/folder-sidebar.tsx) with folder list, inbox, color indicators, and dropdown actions
- [✓] 2026-01-20 23:53 - Add unit tests for FolderSidebar (45 tests) in apps/web/src/components/folders/folder-sidebar.test.tsx

- [✓] 2026-01-21 00:00 - Create Dialog UI component (apps/web/src/components/ui/dialog.tsx) using @base-ui/react/dialog
- [✓] 2026-01-21 00:02 - Create FolderCreateDialog component (apps/web/src/components/folders/folder-create-dialog.tsx) with name input, color picker, and live preview
- [✓] 2026-01-21 00:02 - Add unit tests for FolderCreateDialog (78 tests) in apps/web/src/components/folders/folder-create-dialog.test.tsx

- [✓] 2026-01-21 00:17 - Create FolderEditDialog component (apps/web/src/components/folders/folder-edit-dialog.tsx) with name/color editing, delete confirmation, and live preview
- [✓] 2026-01-21 00:17 - Add unit tests for FolderEditDialog (96 tests) in apps/web/src/components/folders/folder-edit-dialog.test.tsx

- [✓] 2026-01-21 00:32 - Update todo list component (apps/web/src/app/todos/page.tsx) to integrate folder sidebar with filtering
- [✓] 2026-01-21 00:32 - Add folderId support to Todo types (apps/web/src/app/api/todo/todo.types.ts) with SelectedFolderId type
- [✓] 2026-01-21 00:32 - Update useTodoStorage hook to handle folder filtering with selectedFolderId state and filteredTodos
- [✓] 2026-01-21 00:32 - Add updateFolder mutation to todo hooks for moving todos between folders
- [✓] 2026-01-21 00:32 - Update local-todo-storage.ts to support folderId in create and updateFolder operations
- [✓] 2026-01-21 00:32 - Add unit tests for folder filtering in todo hooks (32 tests) testing selectedFolderId, filteredTodos, and updateFolder

- [✓] 2026-01-21 00:51 - Create E2E tests for folder CRUD (25 tests) in apps/web/e2e/folders.spec.ts:
  - Create folder with name and color
  - Edit folder name and color
  - Delete folder with confirmation
  - Move todos to Inbox when folder is deleted
  - Assign todos to folders
  - Filter todos by folder
  - Persist folders after page reload
  - Multiple folders management
  - Empty state handling
- [✓] 2026-01-21 00:51 - Add clearFolderFromTodos function to local-todo-storage.ts to move todos to Inbox when folder is deleted
- [✓] 2026-01-21 00:51 - Update folder hooks to clear todo folderId when folder is deleted in localStorage mode
- [✓] 2026-01-21 00:51 - Export notifyLocalTodosListeners from todo hooks for cross-module notifications

- [✓] 2026-01-21 01:05 - Create subtask router (packages/api/src/routers/subtask.ts) with CRUD procedures: list, create, update, delete, toggle, reorder
- [✓] 2026-01-21 01:05 - Add Zod validation schemas for subtask inputs (createSubtaskInputSchema, updateSubtaskInputSchema, deleteSubtaskInputSchema, toggleSubtaskInputSchema, reorderSubtaskInputSchema, listSubtasksInputSchema)
- [✓] 2026-01-21 01:05 - Add logic to auto-complete parent todo when all subtasks are completed (checkAndAutoCompleteTodo helper)
- [✓] 2026-01-21 01:05 - Add subtask router to main tRPC router (packages/api/src/routers/index.ts)
- [✓] 2026-01-21 01:05 - Add unit tests for subtask router (61 tests) in packages/api/src/routers/subtask.test.ts covering:
  - Input validation for all subtask operations
  - Authorization and ownership verification logic
  - CRUD operations business logic
  - Auto-complete parent todo logic when all subtasks completed

- [✓] 2026-01-21 01:16 - Create subtask.types.ts (apps/web/src/app/api/subtask/subtask.types.ts) with:
  - Unified Subtask type supporting both local (string UUID) and remote (numeric) IDs
  - RemoteSubtask and LocalSubtask interfaces for storage-specific types
  - Zod schemas for remote operations: createSubtaskInputSchema, updateSubtaskInputSchema, deleteSubtaskInputSchema, toggleSubtaskInputSchema, reorderSubtaskInputSchema, listSubtasksInputSchema
  - Zod schemas for local operations: localCreateSubtaskInputSchema, localUpdateSubtaskInputSchema, localDeleteSubtaskInputSchema, localToggleSubtaskInputSchema, localReorderSubtaskInputSchema, localListSubtasksInputSchema
  - UseSubtaskStorageReturn hook return type
  - SubtaskProgress interface and helper functions (calculateSubtaskProgress, areAllSubtasksCompleted)
- [✓] 2026-01-21 01:16 - Add unit tests for subtask types/schemas (69 tests) in apps/web/src/app/api/subtask/subtask.types.test.ts covering:
  - All remote Zod schemas validation (create, update, delete, toggle, reorder, list)
  - All local Zod schemas validation with string IDs
  - SubtaskProgress helper function tests
  - areAllSubtasksCompleted helper function tests

- [✓] 2026-01-21 01:19 - Create subtask.api.ts (apps/web/src/app/api/subtask/subtask.api.ts) with:
  - getSubtasksQueryOptions(input: ListSubtasksInput) for fetching subtasks by todoId
  - getSubtasksQueryKey(todoId: number) for cache key generation
  - getCreateSubtaskMutationOptions() for creating subtasks
  - getUpdateSubtaskMutationOptions() for updating subtask text
  - getDeleteSubtaskMutationOptions() for deleting subtasks
  - getToggleSubtaskMutationOptions() for toggling completion status
  - getReorderSubtaskMutationOptions() for reordering subtasks
- [✓] 2026-01-21 01:19 - Add unit tests for subtask API (16 tests) in apps/web/src/app/api/subtask/subtask.api.test.ts covering:
  - Query options structure and function exports
  - Mutation options structure for all CRUD operations
  - Query key generation with todoId parameter

- [✓] 2026-01-21 01:34 - Create subtask.hooks.ts (apps/web/src/app/api/subtask/subtask.hooks.ts) with:
  - useSubtaskStorage hook for dual-mode subtask management (localStorage for guests, tRPC for authenticated)
  - useSyncExternalStore pattern for local subtask state with per-todoId caching
  - Optimistic updates for all CRUD operations (create, update, toggle, delete, reorder)
  - notifyLocalSubtasksListeners function for cross-module state updates
- [✓] 2026-01-21 01:34 - Create local-subtask-storage.ts (apps/web/src/lib/local-subtask-storage.ts) with:
  - getAll(todoId) - get subtasks for a specific todo
  - create(todoId, text) - create new subtask
  - update(id, text) - update subtask text
  - toggle(id, completed) - toggle completion status
  - deleteSubtask(id) - delete subtask
  - reorder(id, newOrder) - reorder subtask within todo
  - deleteByTodoId(todoId) - delete all subtasks for a todo
  - clearAll() - clear all subtasks
  - getById(id) - get subtask by ID
- [✓] 2026-01-21 01:34 - Add unit tests for subtask hooks (24 tests) in apps/web/src/app/api/subtask/subtask.hooks.test.tsx covering:
  - Authentication state detection
  - Guest mode localStorage operations (CRUD, reorder)
  - Authenticated mode behavior
  - Dual-mode switching on login
  - Loading state management
  - Subtask normalization and sorting by order
  - TodoId filtering
  - Error handling for non-existent subtasks
  - External store pattern stability

- [✓] 2026-01-21 01:48 - Create subtask barrel export (apps/web/src/app/api/subtask/index.ts) with:
  - API exports: query options and mutation options for subtask CRUD operations
  - Hook exports: useSubtaskStorage and notifyLocalSubtasksListeners
  - Type exports: all subtask types (Subtask, RemoteSubtask, LocalSubtask, etc.)
  - Schema exports: all Zod validation schemas for remote and local operations
  - Helper exports: calculateSubtaskProgress and areAllSubtasksCompleted utilities

- [✓] 2026-01-21 01:51 - Update local-todo-storage.ts to integrate with subtask storage:
  - Added import for local-subtask-storage module
  - Updated deleteTodo() to call localSubtaskStorage.deleteByTodoId() to delete associated subtasks when a todo is deleted
- [✓] 2026-01-21 01:51 - Add unit tests for local-todo-storage (48 tests) in apps/web/src/lib/local-todo-storage.test.ts covering:
  - getAll(): empty state, validation of todo structure, field type checking, folderId handling, SSR safety
  - create(): default values, folderId support, UUID generation, appending to existing todos
  - toggle(): completion state toggling, persistence, non-existent todo handling
  - deleteTodo(): todo removal, subtask cascade deletion via localSubtaskStorage.deleteByTodoId()
  - updateFolder(): folderId updates, move to Inbox (null), persistence
  - clearAll(): localStorage removal, SSR safety
  - clearFolderFromTodos(): batch folderId clearing when folder is deleted

- [✓] 2026-01-21 02:10 - Create SubtaskList component (apps/web/src/components/subtasks/subtask-list.tsx) with:
  - SubtaskList component using useSubtaskStorage hook for dual-mode support
  - StandaloneSubtaskList component for direct subtask prop passing (useful for testing)
  - Checkbox toggle for subtask completion with accessible labels
  - Delete button for each subtask with confirmation
  - Loading skeleton state during data fetch
  - Empty state message when no subtasks exist
  - Completed styling with strikethrough text
  - Read-only mode support (disables checkboxes and hides delete buttons)
  - onAllCompleted and onUncompleted callbacks for auto-complete parent todo logic
  - Support for both string (local) and numeric (remote) subtask IDs
- [✓] 2026-01-21 02:10 - Add unit tests for SubtaskList (35 tests) in apps/web/src/components/subtasks/subtask-list.test.tsx covering:
  - Rendering: empty state, subtask list, custom className
  - Loading state: skeleton display and hiding
  - Checkbox toggle: checkbox rendering, checked state, toggle callback
  - Delete subtask: button rendering, delete callback, accessible name
  - Completed styling: strikethrough for completed, no strikethrough for incomplete
  - Read-only mode: hidden delete buttons, disabled checkboxes (aria-disabled)
  - Auto-complete callbacks: onAllCompleted when all done, onUncompleted when unchecked
  - Accessibility: list landmark, semantic list items, checkbox labels
  - Numeric IDs: handling numeric subtask IDs, toggle/delete with numeric IDs
  - StandaloneSubtaskList: rendering, loading, interactions, callbacks, read-only mode

- [✓] 2026-01-21 02:25 - Create SubtaskItem component (apps/web/src/components/subtasks/subtask-item.tsx) with:
  - Extracted from SubtaskList as a reusable component
  - Checkbox for completion toggle with accessible label
  - Delete button with accessible label (hidden on hover until focused/hovered)
  - Strikethrough and muted text styling for completed subtasks
  - Read-only mode support (disables checkbox, hides delete button)
  - Support for both string (local) and numeric (remote) subtask IDs
  - Custom className support
- [✓] 2026-01-21 02:25 - Add unit tests for SubtaskItem (30 tests) in apps/web/src/components/subtasks/subtask-item.test.tsx covering:
  - Rendering: subtask text, data-testid attributes, custom className, numeric IDs
  - Checkbox: unchecked/checked states, toggle callback, accessible labels
  - Delete button: rendering, click callback, accessible label
  - Completed styling: strikethrough, muted text color
  - Read-only mode: hidden delete button, disabled checkbox, styling preserved
  - Accessibility: list item element, keyboard accessible button
  - Edge cases: empty text, long text, special characters, unicode
- [✓] 2026-01-21 02:25 - Updated SubtaskList to import SubtaskItem from separate file for better code organization

- [✓] 2026-01-21 02:44 - Create SubtaskAddInput component (apps/web/src/components/subtasks/subtask-add-input.tsx) with:
  - Text input with placeholder for new subtask text
  - Add button with Plus icon for submission
  - Enter key submission support (with Shift+Enter passthrough)
  - Loading/submitting state that disables input and button
  - Auto-clear input after successful submission
  - Whitespace trimming before submission
  - Custom className and placeholder support
  - AutoFocus option
  - Accessible with proper ARIA labels (input: "New subtask text", button: "Add subtask")
- [✓] 2026-01-21 02:44 - Add unit tests for SubtaskAddInput (34 tests) in apps/web/src/components/subtasks/subtask-add-input.test.tsx covering:
  - Rendering: input, button, placeholders, className
  - Input interaction: typing, clearing after submit, whitespace trimming
  - Enter key submission: submit on Enter, no submit on Shift+Enter, preventDefault
  - Button submission: click handler, disabled states (empty, whitespace)
  - Disabled state: input and button disabled, no submission
  - Async submission: promise handling, double submission prevention, disabled during async
  - AutoFocus: default off, enabled when prop is true
  - Accessibility: input label, button label, keyboard navigation
  - Edge cases: long text, special characters, unicode, rapid submissions
